var $mailbox=$("#sc-mailbox-messages"),$single=$("#sc-message-single"),activeId=null,messages=[];scutum.pages.mailbox={},scutum.pages.mailbox.init=function(){scutum.pages.mailbox.render(),scutum.pages.mailbox.message.show(),scutum.pages.mailbox.message.close(),scutum.pages.mailbox.message.remove(),scutum.pages.mailbox.message.filter(),scutum.helpers.mq.mediumMax()&&UIkit.sticky("#sc-page-top-bar",{offset:scutum.$header.height()}),$("#sc-message-compose").on("shown",function(){$("#sc-message-compose-send-to").trigger("change")})},scutum.pages.mailbox.message={},scutum.pages.mailbox.render=function(){$mailbox.addClass("uk-invisible"),scutum.require(["handlebars"],function(){$.when(scutum.handlebars.getPartial("mailbox-messages"),scutum.helpers.ajax("data/pages/mailbox_messages.json","GET","json")).done(function(e,s){Handlebars.registerPartial("mailbox-messages",e),$.each(s,function(e,s){s.date=moment(s.date).format("ddd, MMM Do HH:mm"),messages.push(s)}),$mailbox.one("render.handlebars",function(e,s){scutum.helpers.sequenceShow.init(null,!0),$mailbox.removeClass("uk-invisible"),scutum.forms.common.icheck($mailbox.find(".sc-js-item-check")),scutum.helpers.iCheck.toggleSingleItem(),scutum.config.customScrollbar&&scutum.$pageContent.data("ps").update()}).hbRender("mailbox-messages",{messages:messages})})},!1)},scutum.pages.mailbox.message.show=function(){scutum.$doc.on("click",".sc-js-message-expand .sc-message-card",function(e){var s,t,a;$(e.target).closest(".sc-js-item-check").length||$(e.target).closest(".sc-message-actions").length||(s=$(this),scutum.$win.scrollTop(),scutum.$pageContent.scrollTop(),e=parseFloat(s.position().top)-parseFloat(scutum.$pageContent.position().top),t=scutum.helpers.mq.mediumMax()?e:e+scutum.$pageContent.scrollTop(),a=s.outerHeight(),activeId=s.closest("li").attr("data-id"),s.hasClass("sc-message-expanded")||(scutum.$pageContent.addClass("sc-page-overflow sc-message-expanded").css({"padding-right":scutum.helpers.scrollbar.width()}),scutum.helpers.overlay.add(scutum.$pageContent,!0,scutum.$pageContent.scrollTop()),scutum.helpers.mq.mediumMax()&&scutum.helpers.scrollbar.disable(),scutum.config.customScrollbar,Handlebars.registerPartial("mailbox-message-single",scutum.handlebars.getPartial("mailbox-message-single")),scutum.helpers.findObjectByKey(messages,"id",activeId).then(function(e){e&&$single.one("render.handlebars",function(e,s){$single.show().css({top:t,height:a}).velocity({top:scutum.$pageContent.scrollTop(),height:parseFloat(scutum.$win.height())-parseFloat(scutum.$pageContent.position().top)+"px"},{delay:100,duration:360,easing:scutum.easingSwiftOut,begin:function(){scutum.$pageWrapper.addClass("sc-message-single"),scutum.forms.common.select2($single)},complete:function(){$single.find(".sc-js-el-show").show().velocity("transition.slideUpIn",{stagger:120,duration:280}),$single.addClass("sc-js-expanded")}})}).hbRender("mailbox-message-single",{message:e})})))})},scutum.pages.mailbox.message.close=function(){scutum.$doc.on("click",".sc-js-message-close",function(e){e.preventDefault();var s=$('[data-id="'+activeId+'"]');$single.find(".sc-js-el-show").velocity("transition.slideDownOut",{stagger:80,duration:140,complete:function(){$single.velocity({height:s.height(),top:parseFloat(s.position().top)+parseFloat(scutum.$pageContent.scrollTop())},{duration:200,begin:function(){$single.removeClass("sc-js-expanded")},complete:function(){$single.fadeOut(),scutum.$pageWrapper.removeClass("sc-message-single"),scutum.helpers.overlay.remove(scutum.$pageContent,!0),setTimeout(function(){scutum.$pageContent.removeClass("sc-page-overflow").css({"padding-right":""}),scutum.helpers.mq.mediumMax()&&scutum.helpers.scrollbar.enable()},320)}})}})})},scutum.pages.mailbox.message.remove=function(){scutum.$doc.on("click",".sc-js-message-remove",function(e){e.preventDefault();var s=$(this).closest("li");s.closest("li").attr("data-id");s.velocity({translateX:"100%",opacity:0},{duration:280,easing:scutum.easingSwiftOut,complete:function(){s.remove(),UIkit.notification('<div class="uk-flex uk-flex-middle"><span class="uk-flex-1">Message deleted!</span><a href="#" class="md-color-amber-500 uk-margin-small-left">undo</a></div>')}})})},scutum.pages.mailbox.message.filter=function(){var e=scutum.$pageWrapper,s=UIkit.filter(e,{target:".sc-js-message-filter"});$(".sc-js-filter-clear").length&&(scutum.$pageWrapper.on("beforeFilter",function(){scutum.$pageContent[0].scrollTop=0}),scutum.$pageWrapper.on("afterFilter",function(){void 0===s.getState().filter[""]?e.removeClass("sc-filtered-items"):e.addClass("sc-filtered-items")})),$(".sc-js-offcanvas-filters").find("li").on("click",function(){var e=$(this).attr("data-uk-filter-control");$(".sc-js-offcanvas-filter").attr("data-uk-filter-control",e).click()})};