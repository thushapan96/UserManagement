var URL=window.URL||window.webkitURL,$image=$("#sc-cropper-image"),$dataX=$("#sc-cropper-dataX"),$dataY=$("#sc-cropper-dataY"),$dataHeight=$("#sc-cropper-dataHeight"),$dataWidth=$("#sc-cropper-dataWidth"),$dataRotate=$("#sc-cropper-dataRotate"),$dataScaleX=$("#sc-cropper-dataScaleX"),$dataScaleY=$("#sc-cropper-dataScaleY"),options={aspectRatio:16/9,preview:".sc-cropper-preview",crop:function(a){$dataX.val(Math.round(a.detail.x)),$dataY.val(Math.round(a.detail.y)),$dataHeight.val(Math.round(a.detail.height)),$dataWidth.val(Math.round(a.detail.width)),$dataRotate.val(a.detail.rotate),$dataScaleX.val(a.detail.scaleX),$dataScaleY.val(a.detail.scaleY)}},$download=$("#sc-cropper-download");void 0===$download[0].download&&$download.addClass("disabled"),scutum.plugins.cropper={},scutum.plugins.cropper.init=function(){scutum.require(["cropper"],function(){scutum.plugins.cropper.initPlugin(),scutum.plugins.cropper.methods(),scutum.plugins.cropper.aspectRatio(),scutum.plugins.cropper.uploadImage()})},scutum.plugins.cropper.initPlugin=function(){$image.on({ready:function(a){},cropstart:function(a){},cropmove:function(a){},cropend:function(a){},crop:function(a){},zoom:function(a){}}).cropper(options)},scutum.plugins.cropper.aspectRatio=function(){$("[data-aspect-ratio]").on("click",function(){$(this).addClass("uk-active").siblings().removeClass("uk-active"),options.aspectRatio=$(this).attr("data-aspect-ratio"),$image.cropper("destroy").cropper(options)})},scutum.plugins.cropper.methods=function(){var a=$(".sc-cropper-buttons");a.find("button[data-method]").each(function(){UIkit.tooltip($(this))}),a.on("click","[data-method]",function(){var a,t,o,e,i,c=$(this),r=c.hasClass("sc-button-radio"),p=c.data(),s=$image.data("cropper"),d=$image.attr("src"),n="image/jpeg";if(!c.prop("disabled")&&!c.hasClass("disabled")&&s&&p.method){if(r&&(c.closest(".uk-button-group").find(".sc-button-radio").removeClass("uk-active"),c.addClass("uk-active")),p=$.extend({},p),void 0!==p.target&&(t=$(p.target),void 0===p.option))try{p.option=JSON.parse(t.val())}catch(a){console.log(a.message)}switch(a=s.cropped,p.method){case"rotate":a&&0<options.viewMode&&$image.cropper("clear");break;case"getCroppedCanvas":p.option||(p.option={}),p.option.fillColor="#fff"}switch(o=$image.cropper(p.method,p.option,p.secondOption),p.method){case"rotate":a&&0<options.viewMode&&$image.cropper("crop");break;case"scaleX":case"scaleY":$(this).data("option",-p.option);break;case"getCroppedCanvas":o&&(i=$("#sc-getCroppedCanvasModal"),UIkit.modal(i).show(),i.find(".uk-modal-body").html(o),$download.hasClass("disabled")||($download.download="cropped.jpg",$download.attr("href",o.toDataURL(n))));break;case"destroy":e&&(URL.revokeObjectURL(e),e="",$image.attr("src",d))}if($.isPlainObject(o)&&t)try{t.val(JSON.stringify(o))}catch(a){console.log(a.message)}}})},scutum.plugins.cropper.uploadImage=function(){var t,o=$("#sc-cropper-inputImage");URL?o.change(function(){var a=this.files;$image.data("cropper")&&a&&a.length&&(a=a[0],/^image\/\w+$/.test(a.type)?(a.name,a.type,t&&URL.revokeObjectURL(t),t=URL.createObjectURL(a),$image.cropper("destroy").attr("src",t).cropper(options),o.val("")):window.alert("Please choose an image file."))}):o.prop("disabled",!0).parent().addClass("disabled")};