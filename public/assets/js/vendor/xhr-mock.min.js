!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.XHRMock=e()}(this,function(){"use strict";var p=(t.prototype.status=function(t){return void 0!==t?(this._status=t,this):this._status},t.prototype.reason=function(t){return void 0!==t?(this._reason=t,this):this._reason},t.prototype.statusText=function(t){return console.warn("xhr-mock: MockResponse.statusText() has been deprecated. Use MockResponse.reason() instead."),void 0!==t?this.reason(t):this.reason()},t.prototype.header=function(t,e){return void 0!==e?(this._headers[t.toLowerCase()]=e,this):this._headers[t.toLowerCase()]||null},t.prototype.headers=function(t){if("object"!=typeof t)return this._headers;for(var e in t)t.hasOwnProperty(e)&&this.header(e,t[e]);return this},t.prototype.body=function(t){return void 0!==t?(this._body=t,this):this._body},t);function t(){this._status=200,this._reason="OK",this._headers={},this._body=null}function o(h,a,u){return function(t,e){if(i=(s=t).method(),s=s.url().toString(),i.toUpperCase()===h.toUpperCase()&&(a instanceof RegExp?(a.lastIndex=0,a.test(s)):s===a))return"object"==typeof u?(n=(r=u).status,o=r.reason,i=r.headers,s=r.body,r=new p,n&&r.status(n),o&&r.reason(o),i&&r.headers(i),s&&r.body(s),r):u(t,e);var r,n,o,s,i}}var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};function e(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var u=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t};function r(r,n){var o,s,i,h={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,s&&(i=s[2&e[0]?"return":e[0]?"throw":"next"])&&!(i=i.call(s,e[1])).done)return i;switch(s=0,(e=i?[0,i.value]:e)[0]){case 0:case 1:i=e;break;case 4:return h.label++,{value:e[1],done:!1};case 5:h.label++,s=e[1],e=[0];continue;case 7:e=h.ops.pop(),h.trys.pop();continue;default:if(!(i=0<(i=h.trys).length&&i[i.length-1])&&(6===e[0]||2===e[0])){h=0;continue}if(3===e[0]&&(!i||e[1]>i[0]&&e[1]<i[3])){h.label=e[1];break}if(6===e[0]&&h.label<i[1]){h.label=i[1],i=e;break}if(i&&h.label<i[2]){h.label=i[2],h.ops.push(e);break}i[2]&&h.ops.pop(),h.trys.pop();continue}e=n.call(r,h)}catch(t){e=[6,t],s=0}finally{o=i=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}var j="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function s(t,e){return t(e={exports:{}},e.exports),e.exports}var T=s(function(q,_){!function(t){var e=_&&!_.nodeType&&_,r=q&&!q.nodeType&&q,n="object"==typeof j&&j;n.global!==n&&n.window!==n&&n.self!==n||(t=n);var o,s,v=2147483647,E=36,b=1,w=26,i=38,h=700,g=72,O=128,S="-",a=/^xn--/,u=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,l={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},c=E-b,C=Math.floor,N=String.fromCharCode;function T(t){throw RangeError(l[t])}function f(t,e){for(var r=t.length,n=[];r--;)n[r]=e(t[r]);return n}function d(t,e){var r=t.split("@"),n="";return 1<r.length&&(n=r[0]+"@",t=r[1]),n+f((t=t.replace(p,".")).split("."),e).join(".")}function R(t){for(var e,r,n=[],o=0,s=t.length;o<s;)55296<=(e=t.charCodeAt(o++))&&e<=56319&&o<s?56320==(64512&(r=t.charCodeAt(o++)))?n.push(((1023&e)<<10)+(1023&r)+65536):(n.push(e),o--):n.push(e);return n}function y(t){return f(t,function(t){var e="";return 65535<t&&(e+=N((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=N(t)}).join("")}function x(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function A(t,e,r){var n=0;for(t=r?C(t/h):t>>1,t+=C(t/e);c*w>>1<t;n+=E)t=C(t/c);return C(n+(c+1)*t/(t+i))}function m(t){var e,r,n,o,s,i,h,a=[],u=t.length,p=0,l=O,c=g,f=t.lastIndexOf(S);for(f<0&&(f=0),r=0;r<f;++r)128<=t.charCodeAt(r)&&T("not-basic"),a.push(t.charCodeAt(r));for(n=0<f?f+1:0;n<u;){for(o=p,s=1,i=E;u<=n&&T("invalid-input"),h=t.charCodeAt(n++),(E<=(h=h-48<10?h-22:h-65<26?h-65:h-97<26?h-97:E)||h>C((v-p)/s))&&T("overflow"),p+=h*s,!(h<(h=i<=c?b:c+w<=i?w:i-c));i+=E)s>C(v/(h=E-h))&&T("overflow"),s*=h;c=A(p-o,e=a.length+1,0==o),C(p/e)>v-l&&T("overflow"),l+=C(p/e),p%=e,a.splice(p++,0,l)}return y(a)}function D(t){for(var e,r,n,o,s,i,h,a,u,p,l,c=[],f=(t=R(t)).length,d=O,y=g,m=e=0;m<f;++m)(a=t[m])<128&&c.push(N(a));for(r=n=c.length,n&&c.push(S);r<f;){for(o=v,m=0;m<f;++m)d<=(a=t[m])&&a<o&&(o=a);for(o-d>C((v-e)/(u=r+1))&&T("overflow"),e+=(o-d)*u,d=o,m=0;m<f;++m)if((a=t[m])<d&&++e>v&&T("overflow"),a==d){for(s=e,i=E;!(s<(h=i<=y?b:y+w<=i?w:i-y));i+=E)l=s-h,p=E-h,c.push(N(x(h+l%p,0))),s=C(l/p);c.push(N(x(s,0))),y=A(e,u,r==n),e=0,++r}++e,++d}return c.join("")}if(o={version:"1.3.2",ucs2:{decode:R,encode:y},decode:m,encode:D,toASCII:function(t){return d(t,function(t){return u.test(t)?"xn--"+D(t):t})},toUnicode:function(t){return d(t,function(t){return a.test(t)?m(t.slice(4).toLowerCase()):t})}},0,e&&r)if(q.exports==e)r.exports=o;else for(s in o)o.hasOwnProperty(s)&&(e[s]=o[s]);else t.punycode=o}(j)}),R={isString:function(t){return"string"==typeof t},isObject:function(t){return"object"==typeof t&&null!==t},isNull:function(t){return null===t},isNullOrUndefined:function(t){return null==t}};function i(t,e,r,n){e=e||"&",r=r||"=";var o={};if("string"!=typeof t||0===t.length)return o;var s=/\+/g;t=t.split(e),e=1e3,n&&"number"==typeof n.maxKeys&&(e=n.maxKeys);var i=t.length;0<e&&e<i&&(i=e);for(var h=0;h<i;++h){var a,u=t[h].replace(s,"%20"),p=u.indexOf(r),l=0<=p?(a=u.substr(0,p),u.substr(p+1)):(a=u,""),c=decodeURIComponent(a),p=decodeURIComponent(l);u=o,l=c,Object.prototype.hasOwnProperty.call(u,l)?Array.isArray(o[c])?o[c].push(p):o[c]=[o[c],p]:o[c]=p}return o}function h(t){switch(typeof t){case"string":return t;case"boolean":return t?"true":"false";case"number":return isFinite(t)?t:"";default:return""}}function a(r,n,o,t){return n=n||"&",o=o||"=","object"==typeof(r=null===r?void 0:r)?Object.keys(r).map(function(t){var e=encodeURIComponent(h(t))+o;return Array.isArray(r[t])?r[t].map(function(t){return e+encodeURIComponent(h(t))}).join(n):e+encodeURIComponent(h(r[t]))}).join(n):t?encodeURIComponent(h(t))+o+encodeURIComponent(h(r)):""}var x=s(function(t,e){e.decode=e.parse=i,e.encode=e.stringify=a}),l=(x.decode,x.parse,x.encode,x.stringify,y),c=function(t){R.isString(t)&&(t=y(t));return t instanceof g?t.format():g.prototype.format.call(t)};function g(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var A=/^([a-z0-9.+-]+:)/i,f=/:[0-9]*$/,D=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,d=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),q=["'"].concat(d),_=["%","/","?",";","#"].concat(q),P=["/","?","#"],I=/^[+a-z0-9A-Z_-]{0,63}$/,U=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,k={javascript:!0,"javascript:":!0},H={javascript:!0,"javascript:":!0},L={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function y(t,e,r){if(t&&R.isObject(t)&&t instanceof g)return t;var n=new g;return n.parse(t,e,r),n}g.prototype.parse=function(t,e,r){if(!R.isString(t))throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var n=t.indexOf("?"),o=-1!==n&&n<t.indexOf("#")?"?":"#",n=t.split(o);n[0]=n[0].replace(/\\/g,"/");var s=(s=t=n.join(o)).trim();if(!r&&1===t.split("#").length){var i=D.exec(s);if(i)return this.path=s,this.href=s,this.pathname=i[1],i[2]?(this.search=i[2],this.query=e?x.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var h,i=A.exec(s);if(i&&(N=(i=i[0]).toLowerCase(),this.protocol=N,s=s.substr(i.length)),(r||i||s.match(/^\/\/[^@\/]+@[^@\/]+/))&&(!(h="//"===s.substr(0,2))||i&&H[i]||(s=s.substr(2),this.slashes=!0)),!H[i]&&(h||i&&!L[i])){for(var a=-1,u=0;u<P.length;u++)-1!==(p=s.indexOf(P[u]))&&(-1===a||p<a)&&(a=p);-1!==(g=-1===a?s.lastIndexOf("@"):s.lastIndexOf("@",a))&&(O=s.slice(0,g),s=s.slice(g+1),this.auth=decodeURIComponent(O)),a=-1;for(var p,u=0;u<_.length;u++)-1!==(p=s.indexOf(_[u]))&&(-1===a||p<a)&&(a=p);-1===a&&(a=s.length),this.host=s.slice(0,a),s=s.slice(a),this.parseHost(),this.hostname=this.hostname||"";var l="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!l)for(var c=this.hostname.split(/\./),u=0,f=c.length;u<f;u++){var d=c[u];if(d&&!d.match(I)){for(var y="",m=0,v=d.length;m<v;m++)127<d.charCodeAt(m)?y+="x":y+=d[m];if(!y.match(I)){var E=c.slice(0,u),b=c.slice(u+1),w=d.match(U);w&&(E.push(w[1]),b.unshift(w[2])),b.length&&(s="/"+b.join(".")+s),this.hostname=E.join(".");break}}}255<this.hostname.length?this.hostname="":this.hostname=this.hostname.toLowerCase(),l||(this.hostname=T.toASCII(this.hostname));var g=this.port?":"+this.port:"",O=this.hostname||"";this.host=O+g,this.href+=this.host,l&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!k[N])for(u=0,f=q.length;u<f;u++){var S,C=q[u];-1!==s.indexOf(C)&&((S=encodeURIComponent(C))===C&&(S=escape(C)),s=s.split(C).join(S))}l=s.indexOf("#");-1!==l&&(this.hash=s.substr(l),s=s.slice(0,l));var N,l=s.indexOf("?");return-1!==l?(this.search=s.substr(l),this.query=s.substr(l+1),e&&(this.query=x.parse(this.query)),s=s.slice(0,l)):e&&(this.search="",this.query={}),s&&(this.pathname=s),L[N]&&this.hostname&&!this.pathname&&(this.pathname="/"),(this.pathname||this.search)&&(g=this.pathname||"",N=this.search||"",this.path=g+N),this.href=this.format(),this},g.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",r=this.pathname||"",n=this.hash||"",o=!1,s="";this.host?o=t+this.host:this.hostname&&(o=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&R.isObject(this.query)&&Object.keys(this.query).length&&(s=x.stringify(this.query));s=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||L[e])&&!1!==o?(o="//"+(o||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):o=o||"",n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),e+o+(r=r.replace(/[?#]/g,function(t){return encodeURIComponent(t)}))+(s=s.replace("#","%23"))+n},g.prototype.resolve=function(t){return this.resolveObject(y(t,!1,!0)).format()},g.prototype.resolveObject=function(t){R.isString(t)&&((f=new g).parse(t,!1,!0),t=f);for(var e=new g,r=Object.keys(this),n=0;n<r.length;n++){var o=r[n];e[o]=this[o]}if(e.hash=t.hash,""===t.href)return e.href=e.format(),e;if(t.slashes&&!t.protocol){for(var s=Object.keys(t),i=0;i<s.length;i++){var h=s[i];"protocol"!==h&&(e[h]=t[h])}return L[e.protocol]&&e.hostname&&!e.pathname&&(e.path=e.pathname="/"),e.href=e.format(),e}if(t.protocol&&t.protocol!==e.protocol){if(!L[t.protocol]){for(var a=Object.keys(t),u=0;u<a.length;u++){var p=a[u];e[p]=t[p]}return e.href=e.format(),e}if(e.protocol=t.protocol,t.host||H[t.protocol])e.pathname=t.pathname;else{for(var l=(t.pathname||"").split("/");l.length&&!(t.host=l.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==l[0]&&l.unshift(""),l.length<2&&l.unshift(""),e.pathname=l.join("/")}return e.search=t.search,e.query=t.query,e.host=t.host||"",e.auth=t.auth,e.hostname=t.hostname||t.host,e.port=t.port,(e.pathname||e.search)&&(d=e.pathname||"",y=e.search||"",e.path=d+y),e.slashes=e.slashes||t.slashes,e.href=e.format(),e}var c=e.pathname&&"/"===e.pathname.charAt(0),f=t.host||t.pathname&&"/"===t.pathname.charAt(0),d=f||c||e.host&&t.pathname,y=d,m=e.pathname&&e.pathname.split("/")||[],l=t.pathname&&t.pathname.split("/")||[],c=e.protocol&&!L[e.protocol];if(c&&(e.hostname="",e.port=null,e.host&&(""===m[0]?m[0]=e.host:m.unshift(e.host)),e.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===l[0]?l[0]=t.host:l.unshift(t.host)),t.host=null),d=d&&(""===l[0]||""===m[0])),f)e.host=(t.host||""===t.host?t:e).host,e.hostname=(t.hostname||""===t.hostname?t:e).hostname,e.search=t.search,e.query=t.query,m=l;else if(l.length)(m=m||[]).pop(),m=m.concat(l),e.search=t.search,e.query=t.query;else if(!R.isNullOrUndefined(t.search))return c&&(e.hostname=e.host=m.shift(),(w=!!(e.host&&0<e.host.indexOf("@"))&&e.host.split("@"))&&(e.auth=w.shift(),e.host=e.hostname=w.shift())),e.search=t.search,e.query=t.query,R.isNull(e.pathname)&&R.isNull(e.search)||(e.path=(e.pathname||"")+(e.search||"")),e.href=e.format(),e;if(!m.length)return e.pathname=null,e.search?e.path="/"+e.search:e.path=null,e.href=e.format(),e;for(var v=m.slice(-1)[0],f=(e.host||t.host||1<m.length)&&("."===v||".."===v)||""===v,E=0,b=m.length;0<=b;b--)"."===(v=m[b])?m.splice(b,1):".."===v?(m.splice(b,1),E++):E&&(m.splice(b,1),E--);if(!d&&!y)for(;E--;)m.unshift("..");!d||""===m[0]||m[0]&&"/"===m[0].charAt(0)||m.unshift(""),f&&"/"!==m.join("/").substr(-1)&&m.push("");var w,f=""===m[0]||m[0]&&"/"===m[0].charAt(0);return c&&(e.hostname=e.host=!f&&m.length?m.shift():"",(w=!!(e.host&&0<e.host.indexOf("@"))&&e.host.split("@"))&&(e.auth=w.shift(),e.host=e.hostname=w.shift())),(d=d||e.host&&m.length)&&!f&&m.unshift(""),m.length?e.pathname=m.join("/"):(e.pathname=null,e.path=null),R.isNull(e.pathname)&&R.isNull(e.search)||(e.path=(e.pathname||"")+(e.search||"")),e.auth=t.auth||e.auth,e.slashes=e.slashes||t.slashes,e.href=e.format(),e},g.prototype.parseHost=function(){var t=this.host,e=f.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};var m=(v.prototype.toString=function(){return b(this)},v);function v(){}function E(t){var e=new m;if(!t)return e;var r,n=l(t,!0);return n.protocol&&(e.protocol=n.protocol.substr(0,n.protocol.length-1)),n.auth&&(t=(r=n.auth.split(":"))[0],r=r[1],t&&r?(e.username=t,e.password=r):e.username=t),n.hostname&&(e.host=n.hostname),n.port&&(e.port=parseInt(n.port,10)),n.pathname&&(e.path=n.pathname),n.query&&(e.query=n.query),n.hash&&(e.hash=n.hash),e}function b(t){t={protocol:t.protocol,auth:t.username&&t.password?t.username+":"+t.password:t.username,hostname:t.host,port:"number"==typeof t.port?String(t.port):t.port,pathname:t.path,query:t.query,hash:t.hash};return c(t)}var w=["CONNECT","TRACE","TRACK"],O=["DELETE","GET","HEAD","OPTIONS","POST","PUT"],S=(C.prototype.method=function(t){if(void 0===t)return this._method;if(-1!==w.indexOf(t.toUpperCase()))throw new Error('xhr-mock: Method "'+t+'" is forbidden.');return-1!==O.indexOf(t.toUpperCase())?this._method=t.toUpperCase():this._method=t,this},C.prototype.url=function(t){return"string"==typeof t?(this._url=E(t),this):this._url},C.prototype.header=function(t,e){return void 0!==e?(this._headers[t.toLowerCase()]=e,this):this._headers[t.toLowerCase()]||null},C.prototype.headers=function(t){if("object"!=typeof t)return this._headers;for(var e in t)t.hasOwnProperty(e)&&this.header(e,t[e]);return this},C.prototype.body=function(t){return void 0!==t?(this._body=t,this):this._body},C);function C(){this._method="GET",this._url=E(""),this._headers={},this._body=null}var N=(M.prototype.initEvent=function(t,e,r){throw new Error},M.prototype.preventDefault=function(){throw new Error},M.prototype.stopImmediatePropagation=function(){throw new Error},M.prototype.stopPropagation=function(){throw new Error},M.prototype.deepPath=function(){throw new Error},M);function M(t,e){var r;this.eventPhase=0,this.type=t||"",e&&(t=void 0!==(r=e.scoped)&&r,r=void 0!==(r=e.bubbles)&&r,e=void 0!==(e=e.cancelable)&&e,this.scoped=t,this.bubbles=r,this.cancelable=e)}var G,X=(e(F,G=N),F.prototype.initProgressEvent=function(t,e,r,n,o,s){throw new Error},F);function F(t,e){var r,n=G.call(this,t,e)||this;return e&&(t=void 0!==(r=e.lengthComputable)&&r,r=void 0===(r=e.loaded)?0:r,e=void 0===(e=e.total)?0:e,n.lengthComputable=t,n.loaded=r,n.total=e),n}var V=(B.prototype.addEventListener=function(t,e,r){this.listeners=this.listeners||{},e&&(this.listeners[t]||(this.listeners[t]=[]),-1===this.listeners[t].indexOf(e)&&this.listeners[t].push(e))},B.prototype.removeEventListener=function(t,e,r){this.listeners=this.listeners||{},e&&(!this.listeners[t]||-1!==(e=this.listeners[t].indexOf(e))&&this.listeners[t].splice(e,1))},B.prototype.dispatchEvent=function(e){var r=this;this.listeners=this.listeners||{},e.target=this;var t=(e.currentTarget=this)["on"+e.type];return t&&t.call(this,e),this.listeners[e.type]&&this.listeners[e.type].forEach(function(t){("function"==typeof t?t:t.handleEvent).call(r,e)}),!0},B);function B(){this.listeners={}}var K,d=(e($,K=V),$);function $(){return null!==K&&K.apply(this,arguments)||this}var z,Z=(e(J,z=d),J);function J(){return null!==z&&z.apply(this,arguments)||this}var Q,W=(e(Y,Q=Error),Y);function Y(t){t=Q.call(this,t)||this;return Object.setPrototypeOf(t,Y.prototype),t}var tt=new W("No handler returned a response for the request.");function et(t,r){return t.split("\n").map(function(t,e){return Array(r+1).join(" ")+t}).join("\n")}function rt(t,e,r){return"xhr-mock: "+t+"\n\n  "+et((n=e,t=Object.keys(n.headers()).map(function(t){return t+": "+n.header(t)}),e=n.body()?n.body():"",n.method()+" "+n.url()+" HTTP/1.1\n"+(t?t.join("\n")+"\n":"")+"\n"+(e||"")+"\n"),2).trim()+"\n  "+(void 0!==r?"\n"+et(r&&r.stack||r&&r.message||"Error: "+r,2):"")+"\n";var n}var nt,ot=new W("This feature hasn't been implmented yet. Please submit an Issue or Pull Request on Github."),st=["CONNECT","TRACE","TRACK"];function it(t){var e=t.header("content-length"),r=t.body(),n=!1,t=0;return!e||NaN!==(e=parseInt(e,10))&&(n=!0,t=e),{lengthComputable:n,loaded:r&&r.length||0,total:t}}(V=nt=nt||{})[V.UNSENT=0]="UNSENT",V[V.OPENED=1]="OPENED",V[V.HEADERS_RECEIVED=2]="HEADERS_RECEIVED",V[V.LOADING=3]="LOADING",V[V.DONE=4]="DONE";var ht,at=(e(ut,ht=d),ut.addHandler=function(t){this.handlers.push(t)},ut.removeHandler=function(t){throw ot},ut.removeAllHandlers=function(){this.handlers=[]},Object.defineProperty(ut.prototype,"timeout",{get:function(){return this._timeout},set:function(t){if(0!==t&&this.isSynchronous)throw new W("Timeouts cannot be set for synchronous requests made from a document.");this._timeout=t},enumerable:!0,configurable:!0}),Object.defineProperty(ut.prototype,"response",{get:function(){if(""===this.responseType||"text"===this.responseType)return this.readyState!==this.LOADING&&this.readyState!==this.DONE?"":this.responseText;if(this.readyState!==this.DONE)return null;var t=this.res.body();if(!t)return null;if("json"===this.responseType&&"string"==typeof t)try{return JSON.parse(this.responseText)}catch(t){return null}if("blob"===this.responseType&&"string"==typeof t)try{throw ot}catch(t){return null}if("arraybuffer"===this.responseType&&"string"==typeof t)try{throw ot}catch(t){return null}if("document"===this.responseType&&"string"==typeof t)try{throw ot}catch(t){return null}return t},enumerable:!0,configurable:!0}),Object.defineProperty(ut.prototype,"responseText",{get:function(){return this.res.body()||""},enumerable:!0,configurable:!0}),Object.defineProperty(ut.prototype,"responseXML",{get:function(){throw ot},enumerable:!0,configurable:!0}),Object.defineProperty(ut.prototype,"status",{get:function(){return this.res.status()},enumerable:!0,configurable:!0}),Object.defineProperty(ut.prototype,"statusText",{get:function(){return this.res.reason()},enumerable:!0,configurable:!0}),ut.prototype.getAllResponseHeaders=function(){var e=this.res.headers();return Object.keys(e).map(function(t){return t+": "+e[t]+"\r\n"}).join("")},ut.prototype.getResponseHeader=function(t){return this.readyState<ut.HEADERS_RECEIVED?null:this.res.header(t)},ut.prototype.setRequestHeader=function(t,e){if(this.readyState<ut.OPENED)throw new W("xhr must be OPENED.");this.req.header(t,e)},ut.prototype.overrideMimeType=function(t){throw ot},ut.prototype.open=function(t,e,r,n,o){if(void 0===r&&(r=!0),void 0===n&&(n=null),void 0===o&&(o=null),-1!==st.indexOf(t))throw new W("Method "+t+" is forbidden.");t=t.toUpperCase();e=E(e);if(e.username=n||"",e.password=n&&o||"",!r&&(0!==this._timeout||""!==this.responseType))throw new W("InvalidAccessError");if(this.isSending)throw new W("Unable to terminate the previous request");this.isSending=!1,this.isSynchronous=!r,this.req.method(t).headers({}).url(b(e)),this.applyNetworkError(),this.readyState!==this.OPENED&&(this.readyState=ut.OPENED,this.dispatchEvent(new N("readystatechange")))},ut.prototype.sendSync=function(){var t;try{t=function(t,e,r){for(var n,o=0;o<t.length;++o){var s=t[o](e,r);if(s){if((n=s)&&void 0!==n.then)throw new W("A handler returned a Promise<MockResponse> for a synchronous request.");return s}}throw tt}(ut.handlers,this.req,this.res),this.handleResponseBody(t)}catch(t){ut.errorCallback({req:this.req,err:t}),this.handleError(t)}},ut.prototype.sendAsync=function(){return s=this,a=function(){var o,s,i,h=this;return r(this,function(t){switch(t.label){case 0:if(o=this.req,s=it(this.res),this.dispatchEvent(new X("loadstart",u({},s,{loaded:0}))),this.isUploadComplete||(s=it(this.req),this.upload.dispatchEvent(new X("loadstart",u({},s,{loaded:0})))),this.readyState!==this.OPENED||!this.isSending)return[2];0!==this._timeout&&(this._timeoutTimer=setTimeout(function(){h.isTimedOut=!0,h.handleError()},this._timeout)),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=ut.handlers,r=this.req,n=this.res,e.reduce(function(t,e){return t.then(function(t){return t||e(r,n)})},Promise.resolve(void 0)).then(function(t){if(!t)throw tt;return t}))];case 2:return(i=t.sent(),clearTimeout(this._timeoutTimer),this.isAborted||this.isTimedOut)?[2]:(this.sendRequest(o),this.receiveResponse(i),[3,4]);case 3:return(i=t.sent(),clearTimeout(this._timeoutTimer),this.isAborted||this.isTimedOut)?[2]:(ut.errorCallback({req:this.req,err:i}),this.handleError(i),[3,4]);case 4:return[2]}var e,r,n})},new(h=(h=i=void 0)||Promise)(function(t,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function n(t){try{o(a.throw(t))}catch(t){e(t)}}function o(e){e.done?t(e.value):new h(function(t){t(e.value)}).then(r,n)}o((a=a.apply(s,i||[])).next())});var s,i,h,a},ut.prototype.applyNetworkError=function(){this.res.status(0).reason("").headers({}).body(null)},ut.prototype.reportError=function(t){if(this.readyState=this.DONE,this.isSending=!1,this.applyNetworkError(),this.isSynchronous)throw new W("An error occurred whilst sending a synchronous request.");this.dispatchEvent(new N("readystatechange")),this.isUploadComplete||(this.isUploadComplete=!0,e=it(this.req),this.upload.dispatchEvent(new X(t,e)),this.upload.dispatchEvent(new X("loadend",e)));var e=it(this.res);this.dispatchEvent(new X(t,e)),this.dispatchEvent(new X("loadend",e))},ut.prototype.sendRequest=function(t){var e;this.isUploadComplete||(this.isUploadComplete=!0,e=it(this.req),this.upload.dispatchEvent(new X("progress",e)),this.upload.dispatchEvent(new X("load",e)),this.upload.dispatchEvent(new X("loadend",e)))},ut.prototype.receiveResponse=function(t){this.readyState=this.HEADERS_RECEIVED,this.dispatchEvent(new N("readystatechange")),null!==t.body()&&(this.readyState=this.LOADING,this.dispatchEvent(new N("readystatechange"))),this.handleResponseBody(t)},ut.prototype.handleError=function(t){this.isSending&&(this.isTimedOut?this.reportError("timeout"):this.isAborted?this.reportError("abort"):this.reportError("error"))},ut.prototype.handleResponseBody=function(t){t=it(this.res=t);this.isSynchronous||this.dispatchEvent(new X("progress",t)),this.readyState=this.DONE,this.isSending=!1,this.dispatchEvent(new N("readystatechange")),this.dispatchEvent(new X("load",t)),this.dispatchEvent(new X("loadend",t))},ut.prototype.send=function(t){if(this.readyState!==ut.OPENED)throw new W("Please call MockXMLHttpRequest.open() before MockXMLHttpRequest.send().");if(this.isSending)throw new W("MockXMLHttpRequest.send() has already been called.");var e,r;if(null!=(t="GET"===this.req.method()||"HEAD"===this.req.method()?null:t)){if("undefined"!=typeof Document&&"undefined"!=typeof XMLDocument&&t instanceof Document)e="UTF-8",r=t instanceof XMLDocument?"application/xml":"text/html";else if("undefined"!=typeof Blob&&t instanceof Blob)r=t.type;else if("undefined"!=typeof FormData&&t instanceof FormData)r="multipart/form-data; boundary=----XHRMockFormBoundary";else if("undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams)e="UTF-8",r="application/x-www-form-urlencoded";else{if("string"!=typeof t)throw ot;e="UTF-8",r="text/plain"}this.req.header("content-type")||this.req.header("content-type",e?r+"; charset="+e:r),this.req.body(t)}this.isUploadComplete=!1,this.isTimedOut=!1,null==t&&(this.isUploadComplete=!0),this.isSending=!0,this.isSynchronous?this.sendSync():this.sendAsync()},ut.prototype.abort=function(){clearTimeout(this._timeoutTimer),this.isAborted=!0,this.readyState!==this.OPENED&&this.readyState!==this.HEADERS_RECEIVED&&this.readyState!==this.LOADING||this.reportError("abort"),this.readyState===this.DONE&&(this.readyState=this.UNSENT,this.applyNetworkError())},ut.prototype.msCachingEnabled=function(){return!1},ut.UNSENT=nt.UNSENT,ut.OPENED=nt.OPENED,ut.HEADERS_RECEIVED=nt.HEADERS_RECEIVED,ut.LOADING=nt.LOADING,ut.DONE=nt.DONE,ut.handlers=[],ut.errorCallback=function(t){var e=t.req,t=t.err;t instanceof W?console.error(rt(t.message,e)):console.error(rt("A handler returned an error for the request.",e,t))},ut);function ut(){var t=null!==ht&&ht.apply(this,arguments)||this;return t.UNSENT=nt.UNSENT,t.OPENED=nt.OPENED,t.HEADERS_RECEIVED=nt.HEADERS_RECEIVED,t.LOADING=nt.LOADING,t.DONE=nt.DONE,t.withCredentials=!1,t.req=new S,t.res=new p,t.responseType="",t.responseURL="",t._timeout=0,t.upload=new Z,t.readyState=ut.UNSENT,t.isSynchronous=!1,t.isSending=!1,t.isUploadComplete=!1,t.isAborted=!1,t.isTimedOut=!1,t}var pt=window.XMLHttpRequest;function lt(){this.RealXMLHttpRequest=pt}return new(lt.prototype.setup=function(){return window.XMLHttpRequest=at,this.reset(),this},lt.prototype.teardown=function(){return this.reset(),window.XMLHttpRequest=pt,this},lt.prototype.reset=function(){return at.removeAllHandlers(),this},lt.prototype.error=function(t){return at.errorCallback=t,this},lt.prototype.mock=function(t,e,r){if(console.warn("xhr-mock: XHRMock.mock() has been deprecated. Use XHRMock.use() instead."),"string"==typeof t&&("string"==typeof e||e instanceof RegExp)&&void 0!==r)return this.use(t,e,r);if("function"==typeof t)return this.use(t);throw new Error("xhr-mock: Invalid handler.")},lt.prototype.use=function(t,e,r){var n;if("string"==typeof t&&("string"==typeof e||e instanceof RegExp)&&void 0!==r)n=o(t,e,r);else{if("function"!=typeof t)throw new Error("xhr-mock: Invalid handler.");n=t}return at.addHandler(n),this},lt.prototype.get=function(t,e){return this.use("GET",t,e)},lt.prototype.post=function(t,e){return this.use("POST",t,e)},lt.prototype.put=function(t,e){return this.use("PUT",t,e)},lt.prototype.patch=function(t,e){return this.use("PATCH",t,e)},lt.prototype.delete=function(t,e){return this.use("DELETE",t,e)},lt)});